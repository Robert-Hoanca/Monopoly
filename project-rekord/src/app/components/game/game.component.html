<div id="gameContainer" fxLayout="column" fxLayoutAlign="center center">

    <th-canvas id="gameCanvas" #canvas (onResize)=resizeCanvas($event) [shadow]="true" [rendererParameters]="rendererOptions">
        <th-scene [thStats]="true" [autoUpdate]="true" #scene>
            
            <th-ambientLight [color]="[gameService.ambientLightColor]" #ambientLight> </th-ambientLight>
            <th-pointLight
            #light
            [castShadow]="true"
            [position]="[-15,10,-15]"
            ></th-pointLight>
            <app-card *ngFor="let card of gameService.gameTable.cards;let i = index" [card]="card" [cardIndex]="i" [scene]="scene"></app-card>
            <app-player *ngFor="let player of gameService.players" [player]="player"></app-player>

          <th-object3D
                    loadGLTF
                    [url]="'/assets/blenderModels/Maps/skyboxSimple/skyBoxEnv.gltf'"
                    [position]="[10,-25,10]"
                    [scale]="[1,1,1]"
                    [receiveShadow]="true"
                    #sky
            >
            <!--<th-texture loadTexture url="/assets/blenderModels/Maps/skyboxSimple/SimpleSky.png"></th-texture>-->
            </th-object3D>

            <th-object3D
            loadGLTF
            [url]="'/assets/blenderModels/Maps/skyboxSimple/skyBoxClouds.gltf'"
            [position]="[10,35,10]"
            [scale]="[1,1,1]"
            [receiveShadow]="true"
            >
            </th-object3D>

            <th-mesh
            [position]="[0,-1,0]"
                [scale]="[1000, 0.2, 1000]"
                >
                <th-boxGeometry></th-boxGeometry>
                <th-meshBasicMaterial [args]="{color: '#A3F3F1'}"></th-meshBasicMaterial>
            </th-mesh>

            <th-perspectiveCamera
                [args]="[100, 2, 0.1, 1000]"
                [lookAt]="gameService.cameraLookAt"
                [position]="gameService.cameraPosition"
                #camera
            >
                <!--<th-orbitControls></th-orbitControls>-->
                <th-mapControls #cameraControls></th-mapControls>
            </th-perspectiveCamera>
        </th-scene>
      </th-canvas>
      

    <div id="playersContainer" fxLayout="column" fxLayoutAlign="space-around center">
       
        <mat-card id="playerCard" *ngFor="let player of gameService.players" [ngStyle]="{'width': gameService.actualTurnPlayer.id == player.id? '120%': '100%'}" [ngClass]="[player.bankrupt? 'bankrupt': 'noBankrupt']" fxLayout="column" fxLayoutAlign="center center">
            <span>{{player.name}}</span>
            <span>{{player.money}} â‚¬</span>
        </mat-card>
    </div>

    <div id="gameButtons" fxLayout="row" fxLayoutAlign="space-around center">
        <button mat-raised-button id="seeProperties" *ngIf="!gameService.actualTurnPlayer.canDice" [matMenuTriggerFor]="propertiesMenu" [disabled]="!getActualPlayerProps().length"><mat-icon>view_carousel</mat-icon></button>
        <mat-menu #propertiesMenu="matMenu">
            <button mat-menu-item class="actualPlayerProperty" *ngFor="let property of getActualPlayerProps()" (click)="gameService.openCardDialog(property)"><span [ngStyle]="{'background': property.district}" class="districtColor"></span>{{property.name}}</button>
        </mat-menu>


        <button mat-raised-button id="openExchange" *ngIf="!gameService.actualTurnPlayer.canDice" (click)="gameService.openExchangeDialog()"><mat-icon>currency_exchange</mat-icon></button>

        <button mat-raised-button id="nextTurnBtn" *ngIf="!gameService.actualTurnPlayer.canDice" (click)="gameService.nextTurn()"><mat-icon>skip_next</mat-icon></button>

        <button mat-raised-button id="diceBtn" *ngIf="gameService.actualTurnPlayer.canDice" (click)="gameService.rollTheDice()"><mat-icon>casino</mat-icon></button>
        <button mat-raised-button id="diceBtn" *ngIf="gameService.actualTurnPlayer.prison.inPrison && gameService.actualTurnPlayer.canDice" (click)="gameService.whatToDoInprison('payToExit')"><mat-icon>payments</mat-icon></button>

    </div>
    <button mat-icon-button id="pauseBtn" (click)="gameService.gamePaused=true"><mat-icon>pause</mat-icon></button>
    <div *ngIf="gameService.gamePaused" class="pausedGame" fxLayout="column" fxLayoutAlign="center center">
        <button mat-raised-button (click)="gameService.gamePaused=false">Continue</button>
        <button mat-raised-button disabled="true">Options</button>
        <button mat-raised-button disabled="true">Home</button>
    </div>
    
    <ng-template #moneyDialog>
        <h1>{{textDialog}}</h1>
    </ng-template>

    <!--
        DELETE
    <button mat-raised-button id="blblbl" (click)="gameService.test()">buy properties</button>
    <button mat-raised-button (click)="gameService.setDB()">Set db</button>
        <button mat-raised-button id="blblbl" (click)="gameService.test()">click me</button>

         <mat-form-field>
            <mat-label>Choose Your Name</mat-label>
            <input matInput type="color" autocomplete="off" [ngModel]="gameService.ambientLightColor">
        </mat-form-field>
    -->
</div>